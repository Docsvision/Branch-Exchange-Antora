[[ariaid-title1]]
== Приложение A.2. Распределенное согласование

Сценарий «Распределенное согласование» реализует отправку заданий согласования для исполнителей, находящихся в удаленном офисе. Данный сценарий формируется с использованием нескольких [.dfn .term]_сценариев обмена_, приведённых ниже.

[NOTE]
====
[.note__title]#Прим.:# Данными сценариями поддерживается функция коррекции времени для загружаемых заданий – в настройках сервером должен быть указан часовой пояс.
====

=== Сценарий «Согласование»

Данный сценарий запускается при переходе задания [.dfn .term]_На согласование_ в одно из следующих состояний:

* «Не начато»,
* «Делегировано»,
* «Завершено»,
* «Возврат с делегирования»,
* «Отозвано»,
* «Отклонено».

.[.table--title-label]##Табл. 1. ##[.title]##Описание сценария обмена##
[width="99%",cols="34%,66%",options="header",]
|===
|Этап |Действие
|Определение адресатов |Логика выбора адресата приведена в таблице «Определение адресатов и состава передачи»
|Определение состава передачи |Логика определения состава передачи приведена в таблице «Определение адресатов и состава передачи»
|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки a|
Если сервера отправителя и получателя находятся в разных часовых поясах, то будет произведена соответствующая коррекция времени исполнения задания и прочих значений, привязанных к точному времени.

При загрузке заданий с состоянием «Не начато», «Делегировано» и «Возврат с делегирования», будет произведена рассылки заданий на электронную почту.

Логика разрешения конфликтов приведена в таблице «Схема разрешения конфликтов»

|===

=== Сценарий «Подписание»

Данный сценарий запускается при переходе задания [.dfn .term]_На подписание_ в одно из следующих состояний:

* «Не начато»,
* «Делегировано»,
* «Завершено»,
* «Возврат с делегирования»,
* «Отозвано»,
* «Отклонено».

.[.table--title-label]##Табл. 2. ##[.title]##Описание сценария обмена##
[width="99%",cols="34%,66%",options="header",]
|===
|Этап |Действие
|Определение адресатов |Логика выбора адресата приведена в таблице «Определение адресатов и состава передачи»
|Определение состава передачи |Логика определения состава передачи приведена в таблице «Определение адресатов и состава передачи»
|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки a|
Если сервера отправителя и получателя находятся в разных часовых поясах, то будет произведена соответствующая коррекция времени исполнения задания и прочих значений, привязанных к точному времени.

При загрузке заданий с состоянием «Не начато», «Делегировано» и «Возврат с делегирования», будет произведена рассылки заданий на электронную почту.

Логика разрешения конфликтов приведена в таблице «Схема разрешения конфликтов»

|===

=== Определение адресатов и состава передачи

Определение получателей [.dfn .term]_Заданий интеграции_ производится по таблице приведенной далее.

.[.table--title-label]##Табл. 3. ##[.title]##Определение адресатов и состава передачи##
[width="100%",cols="19%,45%,36%",options="header",]
|===
|Состояние |Адресат |Состав передачи
|Не начато, Делегировано |В список [.dfn .term]_получателей_ добавляются сервера текущих исполнителей. a|
В выгрузку включены:

* задание;
* список подчиненных заданий;
* карточка согласования;
* карточка этапа;
* карточка маршрута;
* список ссылок;
* список подписей;
* списки файлов задания;
* связанные документы с их файлами, категориями, списками ссылок и файлов.

|Завершено |В список [.dfn .term]_получателей_ добавляется сервер автора. a|
В выгрузку включены:

* задание;
* список подчиненных заданий;
* карточка согласования;
* карточка этапа;
* карточка маршрута;
* список ссылок;
* список подписей;
* списки файлов задания;
* связанные документы с их файлами, категориями, списками ссылок и файлов.

| |В список [.dfn .term]_получателей_ добавляются сервера текущих исполнителей. |Карточка задания
|Возврат с делегирования |В список [.dfn .term]_получателей_ добавляются сервера текущих исполнителей. a|
В выгрузку включены:

* задание;
* список подчиненных заданий;
* карточка согласования;
* карточка этапа;
* карточка маршрута;
* список ссылок;
* список подписей;
* списки файлов задания;
* связанные документы с их файлами, категориями, списками ссылок и файлов.

|Отозвано |В список [.dfn .term]_получателей_ добавляются сервера текущих исполнителей. |Карточка задания
|Отклонено |В список [.dfn .term]_получателей_ добавляется сервер автора. |Карточка задания
|===

=== Стандартные правила разрешения конфликтов по состояниям

Ниже приведена схема разрешения конфликтов при загрузке данных у [.keyword]*Получателя*. На пересечении состояний используется условное обозначение: «+» – данные перезаписываются на новые, «-» – перезапись не выполняется.

.[.table--title-label]##Табл. 4. ##[.title]##Схема разрешения конфликтов##
[cols=",,,,,,",]
|===
| |*Состояние задания у Получателя* | | | | |
|*Состояние импортируемой карточки* |Подготовка |Не начато |Отклонено |Отложено |Отозвано |В работе
|Не начато |- |+ |+ |+ |+ |-
|Отклонено |- |+ |- |+ |- |+
|Отозвано |- |+ |+ |+ |- |+
|Делегировано |- |+ |- |+ |- |+
|Возврат с делегирования |- |+ |- |+ |- |+
|На приёмке |- |+ |- |+ |- |+
|На доработке |- |+ |- |+ |- |+
|Завершено |- |+ |- |+ |- |+
|===

.[.table--title-label]##Табл. 5. ##[.title]##Продолжение таблицы «Схема разрешения конфликтов»##
[cols=",,,,,",]
|===
| |*Состояние задания у Получателя* | | | |
|*Состояние импортируемой карточки* |Делегировано |Возврат с делегирования |На приёмке |На доработке |Завершено
|Не начато |- |- |- |- |-
|Отклонено |+ |+ |- |- |-
|Отозвано |+ |+ |+ |+ |-
|Делегировано |+ |+ |- |- |-
|Возврат с делегирования |+ |+ |- |- |-
|На приёмке |+ |+ |- |+ |-
|На доработке |+ |+ |+ |- |-
|Завершено |+ |+ |+ |+ |-
|===

Адресат согласования выбирается исходя из текущего состояния карточки, что позволяет избежать дублирования согласования при рассылке [.dfn .term]_Заданий интеграции_. Схема исключения конфликтов позволяет избежать некорректного изменения статуса карточки на всех этапах согласования.

*На уровень выше:* xref:../topics/Appendix_A.adoc[Приложение A. Базовые сценарии обмена]
