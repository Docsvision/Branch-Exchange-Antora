= Приложение A.1. Распределенное исполнение заданий

Сценарий "Распределенное исполнение заданий" реализует отправку заданий _На исполнение_ для исполнителей, находящихся в удаленном офисе. Данный сценарий формируется с использованием нескольких _сценариев обмена_, приведённых ниже.

[NOTE]
====
Данными сценариями поддерживается функция коррекции времени для загружаемых заданий – в настройках сервером должен быть указан часовой пояс.
====

== Сценарий "Запущено задание на исполнение"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Подготовка" в состояние "Не начато".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляются сервера текущих исполнителей.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы.

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание завершено"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Не начато" в состояние "Завершено";
* переход из состояния "В работе" в состояние "Завершено";
* переход из состояния "Возврат с делегирования" в состояние "Завершено";
* переход из состояния "На приёмке" в состояние "Завершено";
* переход из состояния "На приёмке" в состояние "На доработке".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляется сервер автора задания.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы.

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание отозвано"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Не начато" в состояние "Отозвано";
* переход из состояния "Отложено" в состояние "Отозвано";
* переход из состояния "В работе" в состояние "Отозвано";
* переход из состояния "Делегировано" в состояние "Отозвано";
* переход из состояния "Возврат с делегирования" в состояние "Отозвано";
* переход из состояния "На приёмке" в состояние "Отозвано";
* переход из состояния "На доработке" в состояние "Отозвано".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляются сервера текущих исполнителей.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание на доработку"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "На приёмке" в состояние "На доработке".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляется сервер исполнителя задания.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание отклонено"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Не начато" в состояние "Отклонено";
* переход из состояния "В работе" в состояние "Отклонено";
* переход из состояния "Делегировано" в состояние "Отклонено".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляется сервер автора задания.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание на приемку"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Не начато" в состояние "На приёмке";
* переход из состояния "В работе" в состояние "На приёмке";
* переход из состояния "Возврат с делегирования" в состояние "На приёмке";
* переход из состояния "На доработке" в состояние "На приёмке".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляется сервер контролера задания.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание делегировано"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Не начато" в состояние "Делегировано";
* переход из состояния "Отложено" в состояние "Делегировано";
* переход из состояния "В работе" в состояние "Делегировано";
* переход из состояния "Делегировано" в состояние "Делегировано".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляются сервера текущих исполнителей.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Сценарий "Задание в работу"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* переход из состояния "Не начато" в состояние "В работе";
* переход из состояния "Отложено" в состояние "В работе";
* переход из состояния "Делегировано" в состояние "В работе";
* переход из состояния "Возврат с делегирования" в состояние "В работе".

.Описание сценария обмена
[width="100%",cols="34%,66%",options="header"]
|===
|Этап |Действие
|Определение адресатов |В список _получателей_ добавляется сервер автора.
|Определение состава передачи a|
В выгрузку включены:

* текущая карточка;
* карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "Стандартные правила разрешения конфликтов по состояниям".
|===

== Стандартные правила разрешения конфликтов по состояниям

Ниже приведена схема разрешения конфликтов при загрузке данных у [.keyword]*Получателя*. На пересечении состояний используется условное обозначение: "+" – данные перезаписываются на новые, "-" – перезапись не выполняется.

.Схема разрешения конфликтов
[cols=",,,,,"]
|===
| |*Состояние задания у Получателя* | | | |
|*Состояние импортируемой карточки* |Делегировано |Возврат с делегирования |На приёмке |На доработке |Завершено
|Подготовка |- |- |- |- |-
|Не начато |- |- |- |- |-
|Отклонено |+ |+ |- |- |-
|Отложено |+ |+ |- |- |-
|Отозвано |+ |+ |+ |+ |-
|В работе |- |- |- |- |-
|Делегировано |- |+ |- |- |-
|Возврат с делегирования |+ |- |- |- |-
|На приёмке |+ |+ |- |+ |-
|На доработке |+ |+ |+ |- |-
|Завершено |+ |+ |+ |+ |+
|===

.Продолжение таблицы "Схема разрешения конфликтов"
[cols=",,,,,,"]
|===
| |*Состояние задания у Получателя* | | | | |
|*Состояние импортируемой карточки* |Подготовка |Не начато |Отклонено |Отложено |Отозвано |В работе
|Подготовка |- |- |- |- |- |-
|Не начато |- |- |- |- |- |-
|Отклонено |- |+ |- |+ |- |+
|Отложено |- |+ |- |- |- |+
|Отозвано |- |+ |+ |+ |- |+
|В работе |- |+ |- |+ |- |-
|Делегировано |- |+ |- |- |- |+
|Возврат с делегирования |- |+ |- |- |- |+
|На приёмке |- |+ |- |+ |- |+
|На доработке |- |+ |- |+ |- |+
|Завершено |- |+ |- |+ |- |+
|===
