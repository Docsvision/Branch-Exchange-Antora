= Приложение A.1. Распределенное исполнение заданий

Сценарий _Распределенное исполнение заданий_ реализует отправку заданий _На исполнение_ для исполнителей, находящихся в удаленном офисе. Данный сценарий формируется с использованием нескольких _сценариев обмена_, приведённых ниже.

[NOTE]
====
Данными сценариями поддерживается функция коррекции времени для загружаемых заданий -- в настройках сервером должен быть указан часовой пояс.
====

== Сценарий "Запущено задание на исполнение"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Подготовка` в состояние `Не начато`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов
|В список _получателей_ добавляются сервера текущих исполнителей.

|Определение состава передачи
a|В выгрузку включены:

* Текущая карточка.
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки.
* Файлы.

|Выгрузки
|Формирует из каждой карточки, подготовленной к отправке, xml-документ.

|Загрузки
|Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".
|===

[#task-completed]
== Сценарий "Задание завершено"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Не начато` в состояние `Завершено`.
* Переход из состояния `В работе` в состояние `Завершено`.
* Переход из состояния `Возврат с делегирования` в состояние `Завершено`.
* Переход из состояния `На приёмке` в состояние `Завершено`.
* Переход из состояния `На приёмке` в состояние `На приёмке`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов
|В список _получателей_ добавляется сервер автора задания.

|Определение состава передачи
a|В выгрузку включены:

* Текущая карточка.
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки.
* Файлы.

|Выгрузки
|Формирует из каждой карточки, подготовленной к отправке, xml-документ.

|Загрузки
|Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".
|===

[#task-recalled]
== Сценарий "Задание отозвано"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Не начато` в состояние "Отозвано";
* Переход из состояния "Отложено" в состояние "Отозвано";
* Переход из состояния `В работе` в состояние "Отозвано";
* Переход из состояния `Делегировано` в состояние "Отозвано";
* Переход из состояния `Возврат с делегирования` в состояние "Отозвано";
* Переход из состояния `На приёмке` в состояние "Отозвано";
* Переход из состояния `На приёмке` в состояние "Отозвано".

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов |В список _получателей_ добавляются сервера текущих исполнителей.
|Определение состава передачи a|
В выгрузку включены:

* Текущая карточка;
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* Файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".
|===

[#task-completion]
== Сценарий "Задание на доработку"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `На приёмке` в состояние `На приёмке`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов |В список _получателей_ добавляется сервер исполнителя задания.
|Определение состава передачи a|
В выгрузку включены:

* Текущая карточка;
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки;
* Файлы

|Выгрузки |Формирует из каждой карточки, подготовленной к отправке, xml-документ.
|Загрузки |Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".
|===

[#task-declined]
== Сценарий "Задание отклонено"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Не начато` в состояние `Отклонено`.
* Переход из состояния `В работе` в состояние `Отклонено`.
* Переход из состояния `Делегировано` в состояние `Отклонено`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов
|В список _получателей_ добавляется сервер автора задания.

|Определение состава передачи
a|В выгрузку включены:

* Текущая карточка.
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки.
* Файлы.

|Выгрузки
|Формирует из каждой карточки, подготовленной к отправке, xml-документ.

|Загрузки
|Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".

|===

[#task-acceptance]
== Сценарий "Задание на приемку"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Не начато` в состояние `На приёмке`.
* Переход из состояния `В работе` в состояние `На приёмке`.
* Переход из состояния `Возврат с делегирования` в состояние `На приёмке`.
* Переход из состояния `На приёмке` в состояние `На приёмке`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов
|В список _получателей_ добавляется сервер контролера задания.

|Определение состава передачи
a|В выгрузку включены:

* Текущая карточка.
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки.
* Файлы.

|Выгрузки
|Формирует из каждой карточки, подготовленной к отправке, xml-документ.

|Загрузки
|Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".

|===

[#task-delegated]
== Сценарий "Задание делегировано"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Не начато` в состояние `Делегировано`.
* Переход из состояния "Отложено" в состояние `Делегировано`.
* Переход из состояния `В работе` в состояние `Делегировано`.
* Переход из состояния `Делегировано` в состояние `Делегировано`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов
|В список _получателей_ добавляются сервера текущих исполнителей.

|Определение состава передачи
a|В выгрузку включены:

* Текущая карточка.
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки.
* Файлы.

|Выгрузки
|Формирует из каждой карточки, подготовленной к отправке, xml-документ.

|Загрузки
|Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".

|===

[#task-to-work]
== Сценарий "Задание в работу"

Данный сценарий запускается при следующих изменениях состояния задание _На исполнение_:

* Переход из состояния `Не начато` в состояние `В работе`.
* Переход из состояния "Отложено" в состояние `В работе`.
* Переход из состояния `Делегировано` в состояние `В работе`.
* Переход из состояния `Возврат с делегирования` в состояние `В работе`.

.Описание сценария обмена
[cols="34%,66%",options="header"]
|===
|Этап |Действие

|Определение адресатов
|В список _получателей_ добавляется сервер автора.

|Определение состава передачи 
a|В выгрузку включены:

* Текущая карточка.
* Карточки, на которые ссылается задание до 3 уровня, по всем связям, включая сильные ссылки.
* Файлы

|Выгрузки
|Формирует из каждой карточки, подготовленной к отправке, xml-документ.

|Загрузки
|Загрузка производится в соответствии с логикой разрешения конфликтов, проведенной в таблице "<<conflicts,Стандартные правила разрешения конфликтов по состояниям>>".
|===

[#conflicts]
== Стандартные правила разрешения конфликтов по состояниям

Ниже приведена схема разрешения конфликтов при загрузке данных у _Получателя_. На пересечении состояний используется условное обозначение: `+` -- данные перезаписываются на новые, `-` -- перезапись не выполняется.

.Схема разрешения конфликтов
[cols=",,,,,"]
|===
| 5+|Состояние задания у Получателя
|Состояние импортируемой карточки

|Делегировано |Возврат с делегирования |На приёмке |На доработке |Завершено
|Подготовка |- |- |- |- |-
|Не начато |- |- |- |- |-
|Отклонено |+ |+ |- |- |-
|Отложено |+ |+ |- |- |-
|Отозвано |+ |+ |+ |+ |-
|В работе |- |- |- |- |-
|Делегировано |- |+ |- |- |-
|Возврат с делегирования |+ |- |- |- |-
|На приёмке |+ |+ |- |+ |-
|На доработке |+ |+ |+ |- |-
|Завершено |+ |+ |+ |+ |+
|===

.Продолжение таблицы "Схема разрешения конфликтов"
[cols=",,,,,,"]
|===
| 6+|Состояние задания у Получателя

|Состояние импортируемой карточки

|Подготовка |Не начато |Отклонено |Отложено |Отозвано |В работе
|Подготовка |- |- |- |- |- |-
|Не начато |- |- |- |- |- |-
|Отклонено |- |+ |- |+ |- |+
|Отложено |- |+ |- |- |- |+
|Отозвано |- |+ |+ |+ |- |+
|В работе |- |+ |- |+ |- |-
|Делегировано |- |+ |- |- |- |+
|Возврат с делегирования |- |+ |- |- |- |+
|На приёмке |- |+ |- |+ |- |+
|На доработке |- |+ |- |+ |- |+
|Завершено |- |+ |- |+ |- |+
|===
